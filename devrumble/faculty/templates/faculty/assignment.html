{% extends "base.html" %}

{% block title %}CampHub - Teacher Portal{% endblock %}

{% block content %}
<div class="container-fluid py-4">
  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold" style="color: #173859ff;">
      <i class="bi bi-upload me-2"></i>Assignment Upload
    </h2>
    <div>
      <a href="{% url 'teacher_dashboard' %}" class="btn btn-outline-secondary me-2">
        <i class="bi bi-arrow-left me-2"></i>Back to Dashboard
      </a>
    </div>
  </div>

  <!-- Upload Card -->
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card border-primary">
        <div class="card-header bg-primary bg-opacity-10">
          <h4 class="mb-0"><i class="bi bi-file-earmark-arrow-up me-2"></i>Create New Assignment</h4>
        </div>
        <div class="card-body">
          <form id="assignmentForm" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <!-- Basic Information -->
            <div class="mb-4">
              <h5 class="mb-3"><i class="bi bi-info-circle me-2"></i>Assignment Details</h5>
              <div class="mb-3">
                <label for="title" class="form-label">Assignment Title*</label>
                <input type="text" class="form-control" id="title" name="title" 
                      placeholder="Midterm Project - Web Development" required>
              </div>
              
              <div class="mb-3">
                <label for="description" class="form-label">Description*</label>
                <textarea class="form-control" id="description" name="description" 
                          rows="4" placeholder="Detailed instructions for students..." required></textarea>
              </div>
              
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="course" class="form-label">Course*</label>
                  <select class="form-select" id="course" name="course" required>
                    <option value="" selected disabled>Select course</option>
                    <option>CS101 - Introduction to Programming</option>
                    <option>CS201 - Data Structures</option>
                    <option>CS301 - Web Development</option>
                  </select>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="due_date" class="form-label">Due Date*</label>
                  <input type="datetime-local" class="form-control" id="due_date" name="due_date" required>
                </div>
              </div>
            </div>
            
            <!-- File Upload Section -->
            <div class="mb-4">
              <h5 class="mb-3"><i class="bi bi-paperclip me-2"></i>Materials</h5>
              
              <div class="mb-3">
                <label class="form-label">Assignment File (PDF/DOCX)*</label>
                <div class="file-upload-wrapper">
                  <input type="file" class="form-control" id="assignment_file" name="assignment_file" 
                        accept=".pdf,.doc,.docx" required>
                  <small class="text-muted">Max file size: 10MB</small>
                </div>
              </div>
              
              <div class="mb-3">
                <label class="form-label">Additional Resources (Optional)</label>
                <input type="file" class="form-control" id="resources" name="resources" multiple
                      accept=".pdf,.ppt,.pptx,.zip,.jpg,.png">
                <small class="text-muted">Supporting materials for students</small>
              </div>
            </div>
            
            <!-- Grading Options -->
            <div class="mb-4">
              <h5 class="mb-3"><i class="bi bi-check-circle me-2"></i>Grading</h5>
              
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="total_points" class="form-label">Total Points*</label>
                  <input type="number" class="form-control" id="total_points" name="total_points" 
                        min="1" value="100" required>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="rubric" class="form-label">Grading Rubric</label>
                  <select class="form-select" id="rubric" name="rubric">
                    <option value="" selected>None</option>
                    <option>Standard Programming Rubric</option>
                    <option>Research Paper Rubric</option>
                    <option>Presentation Rubric</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="submission_type" class="form-label">Submission Type*</label>
                  <select class="form-select" id="submission_type" name="submission_type" required>
                    <option value="individual" selected>Individual</option>
                    <option value="group">Group</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Advanced Options -->
            <div class="accordion mb-4" id="advancedOptions">
              <div class="accordion-item">
                <h2 class="accordion-header">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
                          data-bs-target="#collapseAdvanced" aria-expanded="false">
                    <i class="bi bi-gear me-2"></i>Advanced Options
                  </button>
                </h2>
                <div id="collapseAdvanced" class="accordion-collapse collapse" data-bs-parent="#advancedOptions">
                  <div class="accordion-body">
                    <div class="mb-3">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="plagiarism_check" name="plagiarism_check">
                        <label class="form-check-label" for="plagiarism_check">
                          Enable plagiarism check
                        </label>
                      </div>
                    </div>
                    <div class="mb-3">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="allow_late" name="allow_late">
                        <label class="form-check-label" for="allow_late">
                          Allow late submissions
                        </label>
                      </div>
                    </div>
                    <div class="mb-3" id="latePenaltyDiv" style="display: none;">
                      <label for="late_penalty" class="form-label">Late Penalty (% per day)</label>
                      <input type="number" class="form-control" id="late_penalty" name="late_penalty" 
                            min="0" max="100" value="10" disabled>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Submission Button -->
            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary btn-lg">
                <i class="bi bi-cloud-arrow-up me-2"></i>Publish Assignment
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- JavaScript for Enhanced Functionality -->
<script>
  // Toggle late penalty field
  document.getElementById('allow_late').addEventListener('change', function() {
    const latePenaltyDiv = document.getElementById('latePenaltyDiv');
    const latePenaltyInput = document.getElementById('late_penalty');
    
    if (this.checked) {
      latePenaltyDiv.style.display = 'block';
      latePenaltyInput.disabled = false;
    } else {
      latePenaltyDiv.style.display = 'none';
      latePenaltyInput.disabled = true;
    }
  });

  // Form submission handling
  document.getElementById('assignmentForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Validate file size
    const fileInput = document.getElementById('assignment_file');
    if (fileInput.files[0].size > 10 * 1024 * 1024) { // 10MB
      alert('File size exceeds 10MB limit');
      return;
    }
    
    // Submit form if validation passes
    this.submit();
  });

  // Preview file name on selection
  document.getElementById('assignment_file').addEventListener('change', function() {
    const fileName = this.files[0]?.name || 'No file selected';
    document.querySelector('.file-upload-wrapper small').textContent = 
      `Selected: ${fileName} (Max 10MB)`;
  });
</script>

<style>
  .file-upload-wrapper {
    position: relative;
  }
  .accordion-button:not(.collapsed) {
    background-color: rgba(23, 56, 89, 0.1);
    color: #173859;
  }
  .card-header {
    border-bottom: 2px solid rgba(23, 56, 89, 0.1);
  }
</style>

{% endblock %}